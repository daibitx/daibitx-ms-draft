# 新增页面指南

本文档详细介绍了如何在项目中新增一个页面，包含完整的步骤和代码示例。

## 目录
- [1. 创建页面组件](#1-创建页面组件)
- [2. 配置路由](#2-配置路由)
- [3. 自动生成菜单和标签页](#3-自动生成菜单和标签页)
- [4. 添加 API 接口](#4-添加-api-接口)
- [5. 使用 Pinia Store](#5-使用-pinia-store)
- [6. 完整示例](#6-完整示例)
- [7. 注意事项和最佳实践](#7-注意事项和最佳实践)

## 1. 创建页面组件

在 `src/pages` 目录下创建新的 Vue 页面组件。

### 示例：创建订单管理页面

```bash
# 创建订单管理页面
touch src/pages/order.vue
```

**`src/pages/order.vue` 基础模板：**

```vue
<template>
  <div class="order-page">
    <!-- 页面标题 -->
    <div class="page-header">
      <h2>订单管理</h2>
      <el-button type="primary" @click="handleAdd">新增订单</el-button>
    </div>

    <!-- 搜索表单 -->
    <el-card class="search-card">
      <el-form :inline="true" :model="searchForm" class="search-form">
        <el-form-item label="订单号">
          <el-input v-model="searchForm.orderNo" placeholder="请输入订单号" />
        </el-form-item>
        <el-form-item label="状态">
          <el-select v-model="searchForm.status" placeholder="请选择状态">
            <el-option label="全部" value="" />
            <el-option label="待支付" value="pending" />
            <el-option label="已支付" value="paid" />
            <el-option label="已完成" value="completed" />
          </el-select>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="handleSearch">搜索</el-button>
          <el-button @click="handleReset">重置</el-button>
        </el-form-item>
      </el-form>
    </el-card>

    <!-- 数据表格 -->
    <el-card class="table-card">
      <Table
        :data="tableData"
        :columns="columns"
        :loading="loading"
        :pagination="pagination"
        @page-change="handlePageChange"
        @size-change="handleSizeChange"
      />
    </el-card>

    <!-- 新增/编辑对话框 -->
    <el-dialog
      v-model="dialogVisible"
      :title="dialogTitle"
      width="600px"
      @close="handleDialogClose"
    >
      <el-form
        ref="formRef"
        :model="formData"
        :rules="formRules"
        label-width="100px"
      >
        <el-form-item label="订单号" prop="orderNo">
          <el-input v-model="formData.orderNo" placeholder="请输入订单号" />
        </el-form-item>
        <el-form-item label="客户名称" prop="customerName">
          <el-input v-model="formData.customerName" placeholder="请输入客户名称" />
        </el-form-item>
        <el-form-item label="订单金额" prop="amount">
          <el-input-number
            v-model="formData.amount"
            :precision="2"
            :step="0.01"
            :min="0"
            style="width: 100%"
          />
        </el-form-item>
        <el-form-item label="状态" prop="status">
          <el-select v-model="formData.status" placeholder="请选择状态" style="width: 100%">
            <el-option label="待支付" value="pending" />
            <el-option label="已支付" value="paid" />
            <el-option label="已完成" value="completed" />
          </el-select>
        </el-form-item>
        <el-form-item label="备注" prop="remark">
          <el-input
            v-model="formData.remark"
            type="textarea"
            :rows="3"
            placeholder="请输入备注"
          />
        </el-form-item>
      </el-form>
      <template #footer>
        <el-button @click="dialogVisible = false">取消</el-button>
        <el-button type="primary" @click="handleSubmit">确定</el-button>
      </template>
    </el-dialog>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, onMounted } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import { useOrderStore } from '@/stores/orderStore'
import Table from '@/components/common/Table.vue'

// 表格列配置
const columns = [
  { prop: 'orderNo', label: '订单号', width: 180 },
  { prop: 'customerName', label: '客户名称', width: 150 },
  {
    prop: 'amount',
    label: '订单金额',
    width: 120,
    formatter: (row: any) => `¥${row.amount?.toFixed(2) || '0.00'}`
  },
  {
    prop: 'status',
    label: '状态',
    width: 100,
    formatter: (row: any) => {
      const statusMap = {
        pending: { text: '待支付', type: 'warning' },
        paid: { text: '已支付', type: 'success' },
        completed: { text: '已完成', type: 'info' }
      }
      const status = statusMap[row.status as keyof typeof statusMap]
      return h('el-tag', { type: status.type }, status.text)
    }
  },
  { prop: 'createTime', label: '创建时间', width: 180 },
  {
    prop: 'operate',
    label: '操作',
    width: 200,
    fixed: 'right',
    buttons: [
      {
        text: '编辑',
        type: 'primary',
        link: true,
        onClick: (row: any) => handleEdit(row)
      },
      {
        text: '删除',
        type: 'danger',
        link: true,
        onClick: (row: any) => handleDelete(row)
      }
    ]
  }
]

// 搜索表单
const searchForm = reactive({
  orderNo: '',
  status: ''
})

// 表格数据
const tableData = ref([])
const loading = ref(false)
const pagination = reactive({
  currentPage: 1,
  pageSize: 10,
  total: 0
})

// 对话框
const dialogVisible = ref(false)
const dialogTitle = ref('新增订单')
const formRef = ref()
const formData = reactive({
  id: undefined,
  orderNo: '',
  customerName: '',
  amount: 0,
  status: 'pending',
  remark: ''
})

// 表单验证规则
const formRules = {
  orderNo: [
    { required: true, message: '请输入订单号', trigger: 'blur' },
    { min: 3, max: 50, message: '长度在 3 到 50 个字符', trigger: 'blur' }
  ],
  customerName: [
    { required: true, message: '请输入客户名称', trigger: 'blur' }
  ],
  amount: [
    { required: true, message: '请输入订单金额', trigger: 'blur' },
    { type: 'number', min: 0, message: '金额不能小于0', trigger: 'blur' }
  ],
  status: [
    { required: true, message: '请选择状态', trigger: 'change' }
  ]
}

// Store
const orderStore = useOrderStore()

// 加载表格数据
const loadTableData = async () => {
  loading.value = true
  try {
    const params = {
      ...searchForm,
      page: pagination.currentPage,
      pageSize: pagination.pageSize
    }
    const res = await orderStore.getOrderList(params)
    tableData.value = res.data
    pagination.total = res.total
  } catch (error) {
    ElMessage.error('加载数据失败')
  } finally {
    loading.value = false
  }
}

// 搜索
const handleSearch = () => {
  pagination.currentPage = 1
  loadTableData()
}

// 重置
const handleReset = () => {
  searchForm.orderNo = ''
  searchForm.status = ''
  handleSearch()
}

// 分页
const handlePageChange = (page: number) => {
  pagination.currentPage = page
  loadTableData()
}

const handleSizeChange = (size: number) => {
  pagination.pageSize = size
  pagination.currentPage = 1
  loadTableData()
}

// 新增
const handleAdd = () => {
  dialogTitle.value = '新增订单'
  dialogVisible.value = true
}

// 编辑
const handleEdit = (row: any) => {
  dialogTitle.value = '编辑订单'
  Object.assign(formData, row)
  dialogVisible.value = true
}

// 删除
const handleDelete = async (row: any) => {
  try {
    await ElMessageBox.confirm('确认删除该订单吗？', '提示', {
      type: 'warning'
    })
    await orderStore.deleteOrder(row.id)
    ElMessage.success('删除成功')
    loadTableData()
  } catch (error) {
    if (error !== 'cancel') {
      ElMessage.error('删除失败')
    }
  }
}

// 提交表单
const handleSubmit = async () => {
  try {
    await formRef.value.validate()
    if (formData.id) {
      await orderStore.updateOrder(formData)
      ElMessage.success('更新成功')
    } else {
      await orderStore.createOrder(formData)
      ElMessage.success('创建成功')
    }
    dialogVisible.value = false
    loadTableData()
  } catch (error) {
    ElMessage.error('操作失败')
  }
}

// 关闭对话框
const handleDialogClose = () => {
  formRef.value?.resetFields()
  Object.assign(formData, {
    id: undefined,
    orderNo: '',
    customerName: '',
    amount: 0,
    status: 'pending',
    remark: ''
  })
}

// 初始化
onMounted(() => {
  loadTableData()
})
</script>

<style scoped lang="scss">
.order-page {
  padding: 20px;

  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;

    h2 {
      margin: 0;
      font-size: 24px;
      font-weight: 500;
    }
  }

  .search-card {
    margin-bottom: 20px;

    .search-form {
      .el-form-item {
        margin-bottom: 0;
      }
    }
  }

  .table-card {
    :deep(.el-card__body) {
      padding: 0;
    }
  }
}
</style>
```

## 2. 配置路由

在 `src/router/modules` 目录下创建对应的路由配置文件。

### 示例：创建订单管理路由

```bash
# 创建订单路由模块
touch src/router/modules/order.ts
```

**`src/router/modules/order.ts` 内容：**

```typescript
import type { RouteRecordRaw } from 'vue-router'

const orderRoutes: RouteRecordRaw[] = [
  {
    path: '/order',
    name: 'Order',
    component: () => import('@/pages/order.vue'),
    meta: {
      title: '订单管理',
      icon: 'ShoppingCart',
      requiresAuth: true,
      // 菜单配置
      menu: {
        parent: 'business', // 父级菜单标识
        order: 1 // 排序
      }
    }
  }
]

export default orderRoutes
```

### 路由配置说明

- `path`: 页面访问路径
- `name`: 路由名称，需唯一
- `component`: 页面组件
- `meta.title`: 页面标题，用于显示在标签页和菜单中
- `meta.icon`: 菜单图标，使用 Element-Plus 图标名称
- `meta.requiresAuth`: 是否需要登录验证
- `meta.menu`: 菜单配置（可选）
  - `parent`: 父级菜单标识
  - `order`: 菜单排序

## 3. 自动生成菜单和标签页

项目已经实现了自动化的菜单和标签页管理，无需手动配置。

### 菜单生成机制

1. **路由自动加载**：`src/router/index.ts` 会自动加载 `modules` 目录下的所有路由模块
2. **菜单数据提取**：`src/layout/Aside.vue` 会自动从路由配置中提取菜单信息
3. **动态菜单渲染**：根据路由的 `meta` 信息自动生成侧边栏菜单

### 标签页管理

1. **自动添加**：当访问新页面时，`src/stores/tabsStore.ts` 会自动添加标签页
2. **自动激活**：当前激活的标签页会自动高亮显示
3. **自动关闭**：可以手动关闭标签页，系统会自动处理状态

### 使用示例

只需在路由配置中正确设置 `meta` 信息，系统会自动处理：

```typescript
{
  path: '/order',
  name: 'Order',
  component: () => import('@/pages/order.vue'),
  meta: {
    title: '订单管理',  // 菜单和标签页标题
    icon: 'ShoppingCart', // 菜单图标
    requiresAuth: true,   // 需要登录
    menu: {
      parent: 'business', // 父级菜单
      order: 1           // 排序
    }
  }
}
```

## 4. 添加 API 接口

在 `src/api/modules` 目录下创建对应的 API 模块文件。

### 示例：创建订单管理 API

```bash
# 创建订单 API 模块
touch src/api/modules/order.ts
```

**`src/api/modules/order.ts` 内容：**

```typescript
import request from '@/utils/request'
import type { AxiosResponse } from 'axios'

// 接口返回数据类型
export interface OrderData {
  id?: number
  orderNo: string
  customerName: string
  amount: number
  status: 'pending' | 'paid' | 'completed'
  remark?: string
  createTime?: string
  updateTime?: string
}

// 列表查询参数
export interface OrderQueryParams {
  orderNo?: string
  status?: string
  page?: number
  pageSize?: number
}

// 列表返回数据
export interface OrderListResponse {
  data: OrderData[]
  total: number
  page: number
  pageSize: number
}

/**
 * 获取订单列表
 * @param params 查询参数
 */
export const getOrderList = (params: OrderQueryParams): Promise<AxiosResponse<OrderListResponse>> => {
  return request({
    url: '/order/list',
    method: 'get',
    params
  })
}

/**
 * 获取订单详情
 * @param id 订单ID
 */
export const getOrderDetail = (id: number): Promise<AxiosResponse<OrderData>> => {
  return request({
    url: `/order/${id}`,
    method: 'get'
  })
}

/**
 * 创建订单
 * @param data 订单数据
 */
export const createOrder = (data: Omit<OrderData, 'id'>): Promise<AxiosResponse<OrderData>> => {
  return request({
    url: '/order',
    method: 'post',
    data
  })
}

/**
 * 更新订单
 * @param data 订单数据
 */
export const updateOrder = (data: OrderData): Promise<AxiosResponse<OrderData>> => {
  return request({
    url: `/order/${data.id}`,
    method: 'put',
    data
  })
}

/**
 * 删除订单
 * @param id 订单ID
 */
export const deleteOrder = (id: number): Promise<AxiosResponse<void>> => {
  return request({
    url: `/order/${id}`,
    method: 'delete'
  })
}

/**
 * 导出订单
 * @param params 查询参数
 */
export const exportOrder = (params: OrderQueryParams): Promise<AxiosResponse<Blob>> => {
  return request({
    url: '/order/export',
    method: 'get',
    params,
    responseType: 'blob'
  })
}
```

### API 模块说明

1. **接口定义**：使用 TypeScript 接口定义请求和响应数据类型
2. **请求方法**：使用 `request` 工具函数发送请求
3. **类型安全**：通过泛型确保返回数据的类型安全
4. **统一处理**：错误处理在 `request.ts` 中统一处理

## 5. 使用 Pinia Store

在 `src/stores` 目录下创建对应的 Store 文件，用于管理页面状态和业务逻辑。

### 示例：创建订单 Store

```bash
# 创建订单 Store
touch src/stores/orderStore.ts
```

**`src/stores/orderStore.ts` 内容：**

```typescript
import { defineStore } from 'pinia'
import {
  getOrderList,
  createOrder,
  updateOrder,
  deleteOrder,
  getOrderDetail,
  exportOrder
} from '@/api/modules/order'
import type {
  OrderData,
  OrderQueryParams,
  OrderListResponse
} from '@/api/modules/order'
import { ElMessage } from 'element-plus'

export const useOrderStore = defineStore('order', {
  state: () => ({
    // 订单列表
    orderList: [] as OrderData[],
    // 当前订单
    currentOrder: null as OrderData | null,
    // 加载状态
    loading: false,
    // 分页信息
    pagination: {
      currentPage: 1,
      pageSize: 10,
      total: 0
    }
  }),

  getters: {
    // 获取订单总数
    totalOrders: (state) => state.pagination.total,
    
    // 获取待支付订单数
    pendingOrders: (state) => {
      return state.orderList.filter(order => order.status === 'pending').length
    }
  },

  actions: {
    /**
     * 获取订单列表
     * @param params 查询参数
     */
    async getOrderList(params: OrderQueryParams) {
      this.loading = true
      try {
        const response = await getOrderList({
          page: this.pagination.currentPage,
          pageSize: this.pagination.pageSize,
          ...params
        })
        
        const { data, total } = response.data
        this.orderList = data
        this.pagination.total = total
        
        return response.data
      } catch (error) {
        ElMessage.error('获取订单列表失败')
        throw error
      } finally {
        this.loading = false
      }
    },

    /**
     * 获取订单详情
     * @param id 订单ID
     */
    async getOrderDetail(id: number) {
      this.loading = true
      try {
        const response = await getOrderDetail(id)
        this.currentOrder = response.data
        return response.data
      } catch (error) {
        ElMessage.error('获取订单详情失败')
        throw error
      } finally {
        this.loading = false
      }
    },

    /**
     * 创建订单
     * @param data 订单数据
     */
    async createOrder(data: Omit<OrderData, 'id'>) {
      try {
        const response = await createOrder(data)
        ElMessage.success('创建订单成功')
        
        // 刷新列表
        await this.getOrderList({})
        
        return response.data
      } catch (error) {
        ElMessage.error('创建订单失败')
        throw error
      }
    },

    /**
     * 更新订单
     * @param data 订单数据
     */
    async updateOrder(data: OrderData) {
      try {
        const response = await updateOrder(data)
        ElMessage.success('更新订单成功')
        
        // 刷新列表
        await this.getOrderList({})
        
        return response.data
      } catch (error) {
        ElMessage.error('更新订单失败')
        throw error
      }
    },

    /**
     * 删除订单
     * @param id 订单ID
     */
    async deleteOrder(id: number) {
      try {
        await deleteOrder(id)
        ElMessage.success('删除订单成功')
        
        // 刷新列表
        await this.getOrderList({})
      } catch (error) {
        ElMessage.error('删除订单失败')
        throw error
      }
    },

    /**
     * 导出订单
     * @param params 查询参数
     */
    async exportOrder(params: OrderQueryParams) {
      try {
        const response = await exportOrder(params)
        
        // 创建下载链接
        const blob = new Blob([response.data])
        const url = window.URL.createObjectURL(blob)
        const link = document.createElement('a')
        link.href = url
        link.download = `订单列表_${new Date().toLocaleDateString()}.xlsx`
        link.click()
        
        window.URL.revokeObjectURL(url)
        ElMessage.success('导出成功')
      } catch (error) {
        ElMessage.error('导出失败')
        throw error
      }
    },

    /**
     * 更新分页
     * @param page 页码
     * @param pageSize 每页条数
     */
    updatePagination(page: number, pageSize: number) {
      this.pagination.currentPage = page
      this.pagination.pageSize = pageSize
    },

    /**
     * 清空当前订单
     */
    clearCurrentOrder() {
      this.currentOrder = null
    }
  }
})
```

### Store 使用说明

1. **状态管理**：集中管理订单相关的状态数据
2. **业务逻辑**：封装 API 调用和业务处理逻辑
3. **类型安全**：使用 TypeScript 确保类型安全
4. **响应式**：状态变化自动更新视图

### 在组件中使用 Store

```typescript
import { useOrderStore } from '@/stores/orderStore'

// 在 setup 中使用
const orderStore = useOrderStore()

// 调用 actions
await orderStore.getOrderList(params)

// 使用 getters
const total = orderStore.totalOrders

// 使用 state
const list = orderStore.orderList
```

## 6. 完整示例

### 步骤总结

1. **创建页面组件** (`src/pages/order.vue`)
2. **配置路由** (`src/router/modules/order.ts`)
3. **添加 API 接口** (`src/api/modules/order.ts`)
4. **创建 Store** (`src/stores/orderStore.ts`)

### 文件结构

```
src/
├── pages/
│   └── order.vue          # 页面组件
├── router/
│   └── modules/
│       └── order.ts       # 路由配置
├── api/
│   └── modules/
│       └── order.ts       # API 接口
└── stores/
    └── orderStore.ts      # 状态管理
```

### 启动项目

完成以上步骤后，重启开发服务器：

```bash
npm run dev
```

访问 `http://localhost:5173/order` 即可看到订单管理页面。

## 7. 注意事项和最佳实践

### 7.1 命名规范

- **文件名**：使用小写字母，多个单词用连字符连接（如 `order-detail.vue`）
- **组件名**：使用大驼峰命名（如 `OrderDetail.vue`）
- **路由名**：使用大驼峰命名（如 `OrderDetail`）
- **Store 名**：使用小驼峰命名（如 `orderStore`）

### 7.2 代码组织

- **页面组件**：放在 `src/pages` 目录
- **公共组件**：放在 `src/components/common` 目录
- **API 接口**：按模块放在 `src/api/modules` 目录
- **状态管理**：按功能放在 `src/stores` 目录

### 7.3 性能优化

- **懒加载**：路由使用动态导入实现懒加载
- **组件缓存**：对于频繁访问的页面，考虑使用 `keep-alive`
- **数据缓存**：在 Store 中缓存数据，避免重复请求

### 7.4 错误处理

- **统一处理**：在 `request.ts` 中统一处理 HTTP 错误
- **用户提示**：使用 `ElMessage` 给用户友好的错误提示
- **日志记录**：重要的错误需要记录到日志系统

### 7.5 安全性

- **权限验证**：在路由守卫中验证用户权限
- **数据验证**：表单数据提交前进行验证
- **敏感信息**：不要在代码中硬编码敏感信息

### 7.6 开发建议

- **TypeScript**：始终使用 TypeScript，确保类型安全
- **Composition API**：使用 `<script setup>` 和 Composition API
- **代码规范**：遵循 ESLint 和 Prettier 规范
- **注释**：复杂逻辑添加必要的注释
- **测试**：编写单元测试和集成测试

### 7.7 常见问题

**Q: 如何添加子菜单？**
A: 在路由配置中使用嵌套路由，设置 `meta.menu.parent` 指定父级菜单。

**Q: 如何隐藏某个路由菜单？**
A: 在 `meta` 中不设置 `menu` 属性，或设置 `meta.hidden: true`。

**Q: 如何设置页面缓存？**
A: 在路由 `meta` 中设置 `keepAlive: true`，并在布局组件中使用 `keep-alive`。

**Q: 如何处理大量数据？**
A: 使用分页、虚拟滚动或懒加载技术。

## 8. 相关文件参考

- [路由配置](./src/router/index.ts)
- [布局组件](./src/layout/index.vue)
- [API 请求工具](./src/utils/request.ts)
- [Store 示例](./src/stores/userStore.ts)

---

**文档版本**: 1.0.0  
**最后更新**: 2025-12-11  
**维护者**: 前端开发团队